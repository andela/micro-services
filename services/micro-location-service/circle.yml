machine:
  node:
    version: 6.3.0
  services:
    - docker
  environment:
    NODE_ENV: test
    DATABASE_URL: postgres://ubuntu:@127.0.0.1:5432/circle_test
    CODECLIMATE_REPO_TOKEN: 5ff3a5a2935171ab891ea9d43ed80c74ea6bb9550f45534efd3f626cca7fb809
    SERVICE_URL: 0.0.0.0:50062
    TOPIC_NAME: location-topic
    LEVELS_SERVICE_URL: 0.0.0.0:50055
    USERS_SERVICE_URL: 0.0.0.0:50051
    PROJECT_NAME: microservices-kube
    CLUSTER_NAME: staging
    CLOUDSDK_COMPUTE_ZONE: us-east1-c
    CONTAINER_NAME: location
    DEPLOYMENT: location
    IMAGE: location
    PROJECT_NAME_PROD: andela-kube
    CLUSTER_NAME_PROD: andela-prod
    CLOUDSDK_COMPUTE_ZONE_PROD: us-east1-b
    CONTAINER_NAME_PROD: location
    DEPLOYMENT_PROD: location
    IMAGE_PROD: location
    IMG_TAG: $(echo $CIRCLE_SHA1 | cut -c -7)
    GRPC_HEALTH_CHECK_TAG: 1.0.1
    DOCKER_PROJECT_NAME: nodejs-docker
    TAG: v1.0.0
checkout:
  post:
    - git submodule sync
    - git submodule update --init
test:
  post:
    - gulp codeclimate
deployment:
  production:
    tag: /v[0-9]+(\.[0-9]+)*/
    owner: andela
    commands:
      - ./shared/deployment.sh
  staging:
    branch: develop
    commands:
      - ./shared/deployment.sh
